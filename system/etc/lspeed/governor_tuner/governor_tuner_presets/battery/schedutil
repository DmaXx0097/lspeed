#!/system/bin/sh

########
#PATHS #
########
# Path where logs and setup is stored
LSPEED_DATA_DIR=/data/lspeed
LOG_DIR=$LSPEED_DATA_DIR/log
LOG=$LOG_DIR/main_log.log

sendToLog() {
timeZone=$(getprop persist.sys.timezone)
printDate=$(TZ="$timeZone" $BUSYBOX date +"%H:%M:%S:%3N %d-%m-%Y")

echo "[$printDate] $1" >> $LOG
}

write() {
	#chmod 0644 "$1"
    echo "$2" > "$1"
}

lockFile() {
	chmod 0644 "$1"
    echo "$2" > "$1"
	chmod 0444 "$1"
}

if [ $1 = "big" ]; then 
	if [ -e $2 ]; then
		if [ -e $2/up_rate_limit_us ]; then
			lockFile $2/up_rate_limit_us "4000"
			sendToLog "up_rate_limit_us=4000"
		fi
	
		if [ -e $2/down_rate_limit_us ]; then
			lockFile $2/down_rate_limit_us "500"
			sendToLog "down_rate_limit_us=500"
		fi
		
		if [ -e $2/hispeed_load ]; then
			lockFile $2/hispeed_load "95"
			sendToLog "hispeed_load=95"
		fi
		
		if [ -e $2/rate_limit_us ]; then
			lockFile $2/rate_limit_us "0"
			sendToLog "rate_limit_us=0"
		fi
		
	fi

elif [ $1 = "middle" ]; then 
	if [ -e $2 ]; then
		if [ -e $2/up_rate_limit_us ]; then
			lockFile $2/up_rate_limit_us "2000"
			sendToLog "up_rate_limit_us=2000"
		fi
	
		if [ -e $2/down_rate_limit_us ]; then
			lockFile $2/down_rate_limit_us "500"
			sendToLog "down_rate_limit_us=500"
		fi
		
		if [ -e $2/hispeed_load ]; then
			lockFile $2/hispeed_load "95"
			sendToLog "hispeed_load=95"
		fi
		
		if [ -e $2/rate_limit_us ]; then
			lockFile $2/rate_limit_us "0"
			sendToLog "rate_limit_us=0"
		fi
		
	fi

elif [ $1 = "little" ]; then 
	if [ -e $2 ]; then
		if [ -e $2/up_rate_limit_us ]; then
			lockFile $2/up_rate_limit_us "2000"
			sendToLog "up_rate_limit_us=2000"
		fi
	
		if [ -e $2/down_rate_limit_us ]; then
			lockFile $2/down_rate_limit_us "500"
			sendToLog "down_rate_limit_us=500"
		fi
		
		if [ -e $2/hispeed_load ]; then
			lockFile $2/hispeed_load "95"
			sendToLog "hispeed_load=95"
		fi
		
		if [ -e $2/rate_limit_us ]; then
			lockFile $2/rate_limit_us "0"
			sendToLog "rate_limit_us=0"
		fi
		
	fi
	
elif [ $1 = "regular" ]; then 
	if [ -e $2 ]; then
		if [ -e $2/up_rate_limit_us ]; then
			lockFile $2/up_rate_limit_us "2000"
			sendToLog "up_rate_limit_us=2000"
		fi
	
		if [ -e $2/down_rate_limit_us ]; then
			lockFile $2/down_rate_limit_us "500"
			sendToLog "down_rate_limit_us=500"
		fi
		
		if [ -e $2/hispeed_load ]; then
			lockFile $2/hispeed_load "95"
			sendToLog "hispeed_load=95"
		fi
		
		if [ -e $2/rate_limit_us ]; then
			lockFile $2/rate_limit_us "0"
			sendToLog "rate_limit_us=0"
		fi
		
	fi

fi
